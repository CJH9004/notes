# 内存管理

## 内存池

### 基本部分

- 首先向操作系统申请大块内存，自己管理这部分内存。
- 它是一个池子，当上层释放内存时它不实际归还给操作系统，而是放回池子重复利用。
- 避免内存碎片，提高内存利用率
- 多线程下的稳定性和效率问题

### 多协程内存管理机制
- 每条线程都有自己的本地的内存
- 有一个全局的分配链，当某个线程中内存不足后就向全局分配链中申请内存。这样就避免了多线程同时访问共享变量时的加锁
- 在避免内存碎片方面，大块内存直接按页为单位分配，小块内存会切成各种不同的固定大小的块，申请做任意字节内存时会向上取整到最接近的块，将整块分配给申请者以避免随意切割。