# p2p udp打洞

## 1.为什么要打洞

NAT等网络中间件实现的非对称通讯模型只允许内网主机初始化对外的连接，不允许外网主机初始化对内网的连接。即服务器不能主动连接一个客户端，必须客户端发起请求后才能初始化连接。

## 2.udp打洞原理

两个udp客户端同时向对方公网ip发送请求，这个请求会被NAT拦截，但会形成NAT映射。下次再发请求是，就不会丢失。

## 3.udp打洞转tcp通信

通常,由于udp打洞实现简单,p2p的实现采用udp打洞较多,然而当通路建立起来后使用tcp进行节点间通信可以获取更好的通信效果。因为udp打洞完成后形成的nat映射是和tcp/udp无关的,所以此时可以转为使用tcp建立连接,达到最终的p2p的tcp通信。
